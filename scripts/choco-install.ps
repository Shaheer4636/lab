# =========================
# TFVC to Azure DevOps Git Migration Script
# =========================

$ErrorActionPreference = "Stop"

# ---- CONFIG ----
$tfvcCollectionUrl = "http://tfs:8080/tfs/<CollectionName>"  # TFVC collection
$tfvcPath          = "$/Driver Centric/Apps/Main/BatchApps/SafetyWorkDayBatchApp"
$adoGitUrl         = "https://dev.azure.com/<org>/<project>/_git/SafetyWorkDayBatchApp"

$migRoot = "C:\MigRepo"
$repoName = "SafetyWorkDayBatchApp"
$repoPath = Join-Path $migRoot $repoName

# ---- PREP ----
if (!(Test-Path $migRoot)) { New-Item -Path $migRoot -ItemType Directory | Out-Null }

Write-Host "Starting TFVC clone with full history + all branches..."
cd $migRoot

# ---- CLONE TFVC ----
# This may take hours for large repos
git tfs clone `
    $tfvcCollectionUrl `
    "$tfvcPath" `
    --with-branches `
    --branches=all `
    --tags `
    --recurse

# ---- CLEANUP ----
cd $repoPath
Write-Host "Cleaning up TFVC bindings..."
git tfs cleanup

# ---- VERIFY BRANCHES ----
Write-Host "`nBranches detected from TFVC:"
git branch -a

# ---- PUSH TO ADO ----
Write-Host "`nPushing to Azure DevOps Git..."
git remote add origin $adoGitUrl

git push --all origin
git push --tags origin

Write-Host "`nMigration complete!"
Write-Host "Repo pushed to: $adoGitUrl"
